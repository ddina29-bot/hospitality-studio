
# 1. Disable auto-detection to prevent the server from defaulting to strict 'npm ci'
providers = []

# 2. Define the environment with necessary build tools for SQLite
[phases.setup]
nixPkgs = ["nodejs_20", "npm", "python3", "make", "gcc", "g++"]

# 3. OVERRIDE INSTALL: 
# We explicitly delete the existing lockfile and node_modules to ensure a fresh start.
# We then run 'npm install' which generates a new, correct lockfile automatically.
[phases.install]
cmds = ["rm -rf package-lock.json node_modules", "npm install"]

# 4. Build the frontend
[phases.build]
cmds = ["npm run build"]

# 5. Start the server
[start]
cmd = "npm start"
