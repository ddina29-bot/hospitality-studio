
# 1. Disable auto-detection to prevent the server from choosing 'npm ci'
providers = []

# 2. Define the environment
[phases.setup]
nixPkgs = ["nodejs_20", "npm", "python3", "make", "gcc", "g++"]

# 3. OVERRIDE INSTALL: 
# Explicitly delete the lockfile causing the error.
# Run 'npm install' to generate a fresh, correct one.
[phases.install]
cmds = ["rm -rf package-lock.json node_modules", "npm install"]

# 4. Build the frontend
[phases.build]
cmds = ["npm run build"]

# 5. Start the server
[start]
cmd = "npm start"
